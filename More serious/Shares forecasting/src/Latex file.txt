\documentclass[12pt, a4paper]{article}
\usepackage[T2A]{fontenc}
\usepackage[utf8]{inputenc}
\usepackage[english,russian]{babel}
\usepackage{graphicx}
\usepackage{amsmath}
\usepackage{float}
\usepackage{graphicx}
\usepackage{tikz}
\usepackage{parskip}
\usepackage{pgfplots}
\pgfplotsset{width=10cm}

\usepackage{geometry}
 \geometry{
 a4paper,
 total={170mm,257mm},
 left = 20mm,
 top=20mm,
 }


\author{Влад Бутковский, 11а, дз по авторегрессии}
\date{22.12.2022}

\begin{document}


\section{Полученные графики}

\begin{tikzpicture}
\begin{axis}[
    title={Price of Tesla stock shares},
    xlabel={Time (aprox 2012-2013)},
    ylabel={Price, \$},
    xmin=0, xmax=140,
    ymin=25, ymax=45,
    xtick={0,25,50,75,100,125},
    ytick={25,27.5,30,32.5,35,37.5,40,42.5,45},
    legend pos=north west,
    ymajorgrids=true,
    xmajorgrids=true,
    grid style=dashed,
]

\addplot[
    color=blue,
    mark=square,
    ]
    coordinates {
    (0,31.51)(5,29.4)(10,29.0)(15,28.610001)(20,26.860001)(25,27.360001)(30,27.370001)(35,30.809999)(40,31.200001)(45,32.290001)(50,32.869999)(55,33.5)(60,32.75)(65,34.049999)(70,33.02)(75,33.900002)(80,32.849998)(85,34.259998)(90,37.130001)(95,37.68)(100,37.290001)(105,38.459999)(110,34.400002)(115,36.970001)(120,38.810001)(125,35.16)(130,37.310001)(135,40.810001)
    };
    \legend{Snap back to reality}

\addplot[
    color=red,
    mark=circle,
    ]
    coordinates {
    (0,29.620644197744053)(5,30.555486059537337)(10,29.13418508771247)(15,28.585888954256493)(20,31.694365258580877)(25,30.28294384503749)(30,30.752334158877005)(35,28.722421742024355)(40,29.861302826626304)(45,28.495951918997786)(50,29.12736845871418)(55,29.38004474137847)(60,28.995147161057062)(65,30.59870776031803)(70,29.60519486725241)(75,29.462178845273286)(80,28.372680532664543)(85,29.364702480462885)(90,29.645961038624556)(95,28.8086104350103)(100,32.22072080387653)(105,29.518618789569082)(110,29.119807148040813)(115,29.9172832314479)(120,28.610232393882782)(125,29.333307689699765)(130,28.22923414346952)(135,29.97034897710158)
    };
    \legend{Pred 1}

\addplot[
    color=yellow,
    mark=circle,
    ]
    coordinates {
    (0,29.916111217997887)(5,28.884527186936026)(10,29.34394266747198)(15,28.85551400874378)(20,28.286488809542064)(25,28.615405687732103)(30,29.592988409319265)(35,30.465616384116103)(40,29.627270084058058)(45,30.40864986504707)(50,30.052405102212475)(55,29.506553487540042)(60,31.186031527164346)(65,28.130303930117698)(70,28.643774964687843)(75,31.359841623603792)(80,28.698012351638706)(85,28.91122975166601)(90,29.705784513517912)(95,31.49532352530202)(100,29.55454633252175)(105,31.41041713308212)(110,28.805914702957818)(115,29.87090939912851)(120,32.833963381612605)(125,28.126472297187835)(130,28.18133463292551)(135,29.1667314860153)
    };
    \legend{Pred 2}

\addplot[
    color=green,
    mark=circle,
    ]
    coordinates {
    (0,31.874652272709636)(5,28.47106265102393)(10,30.693928384821884)(15,28.64994530885585)(20,31.432740553939304)(25,30.087961410803736)(30,30.683437320001282)(35,28.981388828907065)(40,30.138763532153757)(45,28.260133861719478)(50,29.64953132132475)(55,29.711712730978938)(60,29.14985439122659)(65,31.495464818775567)(70,31.68486282992203)(75,29.386520208769475)(80,31.69118859919267)(85,28.33494197540018)(90,28.788003122571237)(95,30.267024676116492)(100,28.13276789803386)(105,32.47367408445842)(110,32.64658205689337)(115,31.12237092573118)(120,28.53152193456767)(125,29.264950194875237)(130,29.543757311203947)(135,29.654645252722165)
    };
    \legend{Pred 3}

\addplot[
    color=magenta,
    mark=circle,
    ]
    coordinates {
    (0,28.565845650791)(5,29.459218023012788)(10,31.116024453514086)(15,30.095154516544223)(20,30.468143190683456)(25,29.63828109650662)(30,28.580706529927458)(35,29.937310928066672)(40,28.707549814201453)(45,28.975992690035095)(50,28.605205475725942)(55,31.635025708400853)(60,28.95303275377658)(65,29.816968759021623)(70,28.899065937663895)(75,29.021327340290046)(80,29.775097242030064)(85,28.82394516379732)(90,29.522549295292066)(95,28.368565291765357)(100,28.363670919654428)(105,29.194085268228843)(110,28.652866197469734)(115,28.560969672762006)(120,30.046363198698312)(125,29.236033773997907)(130,29.887313093447414)(135,28.421159247713927)
    };
    \legend{Pred 4}    
    
\end{axis}
\end{tikzpicture}
\pgfplotsset{width=15cm}

\begin{tikzpicture}
\begin{axis}[
    title={Price of Tesla stock shares},
    xlabel={Time (aprox 17-20)},
    ylabel={Price, \$},
    xmin=0, xmax=490,
    ymin=170, ymax=420,
    xtick={0,50,100,150,200,250,300,350,400,450},
    ytick={200,250,300,350,400,450},
    legend pos=north west,
    ymajorgrids=true,
    xmajorgrids=true,
    grid style=dashed,
]

\addplot[
    color=blue,
    mark=square,
    ]
    coordinates {
    (0,329.290009)(10,309.670013)(20,254.490005)(30,282.51001)(40,293.220001)(50,280.5)(60,281.600006)(70,339.799988)(80,339.5)(90,312.769989)(100,303.640015)(110,345.730011)(120,318.100006)(130,252.25)(140,295.369995)(150,260.0)(160,253.5)(170,340.910004)(180,345.119995)(190,352.0)(200,333.690002)(210,297.380005)(220,344.149994)(230,303.5)(240,303.899994)(250,282.779999)(260,267.299988)(270,281.279999)(280,258.630005)(290,237.0)(300,228.0)(310,185.039993)(320,209.0)(330,218.100006)(340,235.800003)(350,225.550003)(360,232.649994)(370,218.220001)(380,225.169998)(390,238.160004)(400,228.070007)(410,255.100006)(420,309.799988)(430,348.359985)(440,328.690002)(450,362.5)(460,402.079987)(470,516.789978)(480,618.0)
    };
    \legend{Snap back to reality}

\addplot[
    color=red,
    mark=circle,
    ]
    coordinates {
    (0,336.7074081413464)(10,311.507473863267)(20,303.55759214285825)(30,308.5017423116688)(40,283.2061097113908)(50,295.50171606141345)(60,295.3303266968679)(70,314.9643041582352)(80,295.05398645430057)(90,311.64962325903184)(100,298.3960999268621)(110,266.8328386032458)(120,301.4039516296542)(130,271.71396543756174)(140,258.1903044647385)(150,292.02203703633126)(160,290.71611053435294)(170,275.6978278957079)(180,323.06171142714766)(190,255.4008817308611)(200,286.1456960887183)(210,300.9244251315792)(220,250.0491088575697)(230,270.3704960303528)(240,278.39929426400874)(250,259.7576467375894)(260,282.5034345481797)(270,296.64333771271515)(280,258.77809817198033)(290,273.94341319689005)(300,278.14657852043166)(310,235.0770096763609)(320,273.9856458560705)(330,247.42144552379602)(340,289.63308572508845)(350,265.5952645976961)(360,250.76892637439988)(370,247.86789267171912)(380,280.07840885627434)(390,247.78173220182907)(400,264.15849409203025)(410,274.9884768685956)(420,272.15320743207695)(430,263.0438172608798)(440,248.4944821074676)(450,264.8139728070259)(460,237.6518725405918)(470,281.48899561786504)(480,232.04871062370285)
    };
    \legend{Pred 1}

\addplot[
    color=yellow,
    mark=circle,
    ]
    coordinates {
    (0,336.0389023329741)(10,313.05069423674064)(20,301.69564691405395)(30,354.249673434082)(40,299.34762690488753)(50,294.6913957734654)(60,311.01141003205714)(70,321.19075982871215)(80,324.4952913756249)(90,289.3680546174296)(100,308.31813224154575)(110,296.2504312710108)(120,311.09039834614157)(130,277.98565947573627)(140,305.7620893003551)(150,291.13483779314305)(160,333.58927037410217)(170,312.1943487152647)(180,314.18146013736)(190,281.9064589609779)(200,302.72307195788017)(210,309.06579695344976)(220,258.9181566609521)(230,276.965927254257)(240,252.29783900645083)(250,283.64915934154243)(260,281.9768345880854)(270,277.6470218129195)(280,282.41215317330665)(290,258.6090936155813)(300,227.55284323323667)(310,254.7615602410008)(320,273.27181628533776)(330,267.67110583550834)(340,252.23348558024077)(350,299.57848048301344)(360,265.5994548476798)(370,272.16475091345717)(380,273.663282098902)(390,242.12468789354392)(400,263.8861344261352)(410,261.36392821679505)(420,222.21159967763373)(430,247.19849308622682)(440,235.61715104436735)(450,277.98363292153)(460,306.5064938200242)(470,261.78937191584447)(480,243.99664162365139)
    };
    \legend{Pred 2}

\addplot[
    color=green,
    mark=circle,
    ]
    coordinates {
    (0,304.331029218833)(10,309.0445164786773)(20,283.70811254654905)(30,328.8976927377473)(40,290.4488827751228)(50,305.39613352237075)(60,310.06333258547056)(70,309.30506332944356)(80,329.8436702683412)(90,296.3221478096559)(100,289.6312019065357)(110,326.5676272917394)(120,308.18211457401753)(130,296.2784864729756)(140,322.2005613369447)(150,295.1394269132343)(160,280.52213974994663)(170,282.5190711011266)(180,249.56226959904495)(190,347.1931307234221)(200,300.3894690088547)(210,281.5528727821192)(220,279.23963644695135)(230,317.07464869905857)(240,271.7336988723139)(250,300.75191520474704)(260,263.2419251214743)(270,251.68949561687043)(280,255.77028779833105)(290,264.6271304830932)(300,274.2590728670315)(310,266.88790155737166)(320,246.3055720347054)(330,258.7133943667168)(340,266.52273863390326)(350,282.83477206514544)(360,272.69191663909925)(370,233.98125473291827)(380,253.57037407731826)(390,252.35734522145407)(400,263.2646925794255)(410,269.55927854678845)(420,307.8547732105937)(430,212.27146815223605)(440,272.93435368137625)(450,293.1255847423137)(460,249.44588410909762)(470,259.09806654733995)(480,260.552006151922)
    };
    \legend{Pred 3}

\addplot[
    color=magenta,
    mark=circle,
    ]
    coordinates {
    (0,320.8236321591462)(10,314.8659287502943)(20,322.8288251071)(30,323.7325894851626)(40,275.5837539357276)(50,313.15129679588676)(60,312.9895445841016)(70,323.587420876009)(80,283.5954631113021)(90,307.63184724009875)(100,308.7611281025415)(110,276.6054320328079)(120,308.06899387042665)(130,303.738032242742)(140,288.2404346003698)(150,329.400307770141)(160,297.8828568720006)(170,288.73201549451795)(180,283.2327422763692)(190,301.9117862031571)(200,284.64260866269507)(210,290.3895699585139)(220,276.4481210112008)(230,297.4383033083818)(240,254.87636174884466)(250,267.2872501244812)(260,251.5069448694356)(270,264.6352442914582)(280,274.9661892142378)(290,284.9990073960156)(300,271.59086684406003)(310,259.87476595542313)(320,252.58860805210622)(330,283.4837070038002)(340,275.5032534841049)(350,286.4454042743442)(360,281.9737638699794)(370,247.70115457450993)(380,277.1861379169105)(390,272.28325785258573)(400,232.00026651652337)(410,253.7577874920213)(420,290.44162302217245)(430,252.07632274490874)(440,222.97993621381028)(450,244.04749193944124)(460,241.42062717429576)(470,242.0422027409759)(480,222.41386158907557)
    };
    \legend{Pred 4}    
    
\end{axis}
\end{tikzpicture}

\newpage
Те же графики без случайного отклонения
\pgfplotsset{width=10cm}

\begin{tikzpicture}
\begin{axis}[
    title={Price of Tesla stock shares},
    xlabel={Time (aprox 2012-2013)},
    ylabel={Price, \$},
    xmin=0, xmax=140,
    ymin=25, ymax=45,
    xtick={0,25,50,75,100,125},
    ytick={25,27.5,30,32.5,35,37.5,40,42.5,45},
    legend pos=north west,
    ymajorgrids=true,
    xmajorgrids=true,
    grid style=dashed,
]

\addplot[
    color=blue,
    mark=square,
    ]
    coordinates {
    (0,31.51)(5,29.4)(10,29.0)(15,28.610001)(20,26.860001)(25,27.360001)(30,27.370001)(35,30.809999)(40,31.200001)(45,32.290001)(50,32.869999)(55,33.5)(60,32.75)(65,34.049999)(70,33.02)(75,33.900002)(80,32.849998)(85,34.259998)(90,37.130001)(95,37.68)(100,37.290001)(105,38.459999)(110,34.400002)(115,36.970001)(120,38.810001)(125,35.16)(130,37.310001)(135,40.810001)
    };
    \legend{Snap back to reality}

\addplot[
    color=red,
    mark=circle,
    ]
    coordinates {
    (0,29.532303072008926)(5,29.402485298902846)(10,29.27936000804122)(15,29.16784650787593)(20,29.066849693873927)(25,28.975377751701615)(30,28.892532403682917)(35,28.817500087484696)(40,28.749543966728226)(45,28.68799669506907)(50,28.632253862686667)(55,28.58176806082659)(60,28.536043506107703)(65,28.494631171803594)(70,28.457124378286213)(75,28.423154799328778)(80,28.392388845048764)(85,28.364524385970665)(90,28.339287786037872)(95,28.316431215437216)(100,28.29573021684731)(105,28.27698150121072)(110,28.260000951383855)(115,28.24462181405992)(120,28.23069306220912)(125,28.218077911954936)(130,28.206652479321757)(135,28.196304563662803)
    };
    \legend{Pred 1}

\end{axis}
\end{tikzpicture}

\pgfplotsset{width=15cm}

\begin{tikzpicture}
\begin{axis}[
    title={Price of Tesla stock shares},
    xlabel={Time (aprox 17-20)},
    ylabel={Price, \$},
    xmin=0, xmax=490,
    ymin=170, ymax=420,
    xtick={0,50,100,150,200,250,300,350,400,450},
    ytick={200,250,300,350,400,450},
    legend pos=north west,
    ymajorgrids=true,
    xmajorgrids=true,
    grid style=dashed,
]

\addplot[
    color=blue,
    mark=square,
    ]
    coordinates {
    (0,329.290009)(10,309.670013)(20,254.490005)(30,282.51001)(40,293.220001)(50,280.5)(60,281.600006)(70,339.799988)(80,339.5)(90,312.769989)(100,303.640015)(110,345.730011)(120,318.100006)(130,252.25)(140,295.369995)(150,260.0)(160,253.5)(170,340.910004)(180,345.119995)(190,352.0)(200,333.690002)(210,297.380005)(220,344.149994)(230,303.5)(240,303.899994)(250,282.779999)(260,267.299988)(270,281.279999)(280,258.630005)(290,237.0)(300,228.0)(310,185.039993)(320,209.0)(330,218.100006)(340,235.800003)(350,225.550003)(360,232.649994)(370,218.220001)(380,225.169998)(390,238.160004)(400,228.070007)(410,255.100006)(420,309.799988)(430,348.359985)(440,328.690002)(450,362.5)(460,402.079987)(470,516.789978)(480,618.0)
    };
    \legend{Snap back to reality}

\addplot[
    color=red,
    mark=circle,
    ]
    coordinates {
    (0,322.3062154474053)(10,320.1353633620268)(20,318.0285471722821)(30,315.9540784225874)(40,313.9114604598018)(50,311.90020425625164)(60,309.9198282926513)(70,307.96985844282153)(80,306.0498278601778)(90,304.1592768659616)(100,302.29775283918775)(110,300.46481010828154)(120,298.66000984437915)(130,296.88291995626696)(140,295.1331149869336)(150,293.41017601171035)(160,291.7136905379753)(170,290.04325240639776)(180,288.3984616936987)(190,286.7789246169043)(200,285.1842534390693)(210,283.61406637644836)(220,282.0679875070921)(230,280.5456466808467)(240,279.04667943073594)(250,277.5707268857028)(260,276.1174356846918)(270,274.6864578920496)(280,273.27745091422537)(290,271.89007741774947)(300,270.5240052484717)(310,269.1789073520398)(320,267.8544616955982)(330,266.5503511906899)(340,265.2662636173413)(350,264.001891549313)(360,262.7569322804982)(370,261.53108775245136)(380,260.3240644830291)(390,259.13557349612705)(400,257.9653302524956)(410,256.8130545816175)(420,255.6784706146319)(430,254.5613067182876)(440,253.4612954299112)(450,252.37817339337283)(460,251.31168129603572)(470,250.2615638066736)(480,249.22756951434116)
    };
    \legend{Pred 1}  
    
\end{axis}
\end{tikzpicture}

\newpage
\section{Пояснения к программе}
\begin{itemize}
    \item[class Util] Содержит в себе все главные переменные программы, импортирован в каждый другой класс/интерфейс. Первые три элемента задаются нами, это: какая часть данных идет на тренирвку (остаток соответственно на тест), путь до csv-файла, и столбец в котором находятся данные для считываниия. Остальные переменные будут заполнены самой программой
    \item[class Main] Начинается с чтения csv-файла. Содержит в себе создание и заполнение массивов с коэффициентами а. Далее при помощи метода $best_k$ определяет наилучший порядок. Затем заполняется массив $y$, основанный на первых данных из всей базы. Этот массив используется, чтобы определить коэффициенты, которые будут участвовать в функции, описывающей эпсилон. Потом создается непосредственно массив массивов предсказаний. И далее часть кода, создающая графики, чотбы при проверке правильности не переносить данные туда-сюда в эксель.
    \item[class Input] Имеет единственный метод input, принимающий на вход номер последней считывамой строки (при отсутствии считывает все данные). Присваивает значения почти всем элементам из Utils и также создает не только массивы содержащие данные, но и массивы, из которых вычтены средние значения $x$.
    \item[Equation] Имеет два метода. fillmatrix заполняет матрицу и вектор опредеоенного порядка, а solution решает эту систему, используя стороннюю библиотеку Jama, и возвращает массив коэффициентов a.
    \item[Forecasts] Основными методами являются $best_k$ и forecast. Первый находит наилучший порядок, второй же отдает массив с предсказаными элементами. forecastInit является урезаной версией forecast. В нем не прибавляются средние значения и случайное отклонение
    \item[Epsilon] ключевой функцией является epsilon, именно она создает случайное отклонение. "случайность" имеет вид Гауссовой функции. Коэффициенты к ней подбираются при помощи метода getCoef, требующего на вход массив с спрогнозированными данными.
\end{itemize}
\newpage
\section{Анализ результата}
Результаты на мой взгляд предсказывают очень близкое будущее, и то кажется только из-за случайного отклонения. Заметно, как модель не приспособлена к резким "взлетам" в данных. Без случайного отклонения это вообще функция, стремящаяся к какой-то константе и хоть верно подобраный порядок и обеспечивает наименьшее отклонение, это все равно даже близко не похоже на прогноз, которому я бы стал доверять свои пять баксов. Хотя может это акции Теслы слишком нестабильны (графики построены для первых 700 строк данных, так как они хоть сколько-то плоские, или для всех данных).
\end{document}
